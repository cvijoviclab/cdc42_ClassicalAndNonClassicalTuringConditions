# The scripts for generating the results 
There are five categories of code in this project which are necessary for generating the results. These are

1. The FEM-FD algorithm for simulating the dynamics of the RD model which is written in Python (Folder "FEMFD\_AlgorithmForSolvingTheRDsystem\_FEniCSandPython"),
2. A script for calculating the steady states of the homogeneous model used for setting the *Initial Conditions (IC)* in the FEM-FD algorithm. This script is written in Matlab (Folder "FindingInitialConditionsForTheFEMFD\_Algorithm\_Matlab"), 
3. Two pieces of script (one read by the software Gmsh and one Python script) that creates the mesh used in the FEM-FD algorithm and on that converts it into a readable format (Folder "GenerateFEMmesh\_GmshAndPython"),
4. Scripts for generating the mapping of both the classic and non-classic Turing instabilities onto the parameters space written in Matlab (Folder "MappingTheTuringParameterSpace\_Matlab"),
5. Scripts for generating files used for plotting the Results of the FEM-FD algorithm written in Matlab which takes the csv-files generated by the FEM-FD algorithm as input and creates LaTeX files for the plotting as output (Folder "GenerateExperimentalDesignPlots\_Matlab").


The first three scripts are necessary for running the RD-simulations of Cdc42-mediated cell polarisation. The fourth category of scripts are necessary for generating the Turing mapping of the parameter space and the fifth category is necessary for plotting the results generated by the FEM-FD scripts. Subsequently, these five categories will be described in detail. 

# The scripts for running the FEM-FD algorithm
The FEM-FD algorithm is divided into two experimental designs, namely "increasing gamma" and "increasing d", which are the two sub folders in the main folder "FEMFD\_AlgorithmForSolvingTheRDsystem\_FEniCSandPython". These experimental designs is about increasing one parameter (e.g. gamma or d) while keeping the other parameters fixed in order to see how different properties of the cell polarisation process is affected. Specifically, there are three properties that are of interest which are further described in the README file found on the path "Results/README.md". The structure of these two folders are the same and they consist of three main scripts: 

1. *"runscript.sh"*: A bash script made for executing the python scripts, 
2. *"mainFile.py"*: A Python script stored in the sub folder "ScriptsToRun" which contains the experimental design, 
3. *"FEMandFD\_solver\_ImpExp\_linear\_tAdaptive\_PoleFinder.py"*: A Python script stored in the sub folder "ScriptsToRun" which corresponds to the implementation of the FEMFD-algorithm. 

These will now be described in further detail. 

## "runscript.sh"
This is a shell script (in bash) which runs executes the program. Thus, to run the simulations defined in the main-file, type 

"./runscript.sh"

in the terminal. If this does not work, it is perhaps necessary that permission for executing the program is given. This can be done by the command 

"chmod +x runscript.sh". 

An important feature here is to define the number of CPUs that are used when running the program. If one does not predefine this, the computations carried out in the script will be distributed over all cores on the computer which might become slow. If one wishes that only one CPU is used for each execution of the script, this is achieved by 

"export OPENBLAS\_NUM\_THREADS=1". 

If one uses [tmux](https://github.com/tmux/tmux/wiki), for example, one can execute one script in each tmux window meaning that one parallellises the execution of the scripts. 



## "mainFile.py"
In the main file, one defines the parameters as well as the initial conditions (u0,v0) that one wishes to simulate the RD-model with and then one runs FEMFD solver which is described next. If one wishes to run the simulations for different parameter vectors, one can change the data sets defined on the lines 71-87 in the scripts. It also possible to adapt the folder structure and where data files are stored which implies adapting the following lines: 77 and 86 in the main file and lines 211 and 213 in the FEMFD solver described next.  

There is one very important detail, and that is that the steady states implying the initial conditions (u0,v0) on lines 75-76 and 84-85 depend on the parameters c1,c\_{-1}, c\_2, c\_{max}, V_0. Accordingly, one must calculate the initial conditions (u0,v0) in advance for each parameter set which can be done by the Matlab script designed for this (see the description in the next section). 


## "FEMandFD\_solver\_ImpExp\_linear\_tAdaptive\_PoleFinder.py"
This script runs the FEMFD algorithm in order to simulate the spatiotemporal evolution of the presented RD model. It is also possible to save numerous data files of the concentration profile of active cdc42 in order to make a video of the polarisation process or perhaps a figure as the one presented in the folder "Figures/evolutionPattern". In this case, one has to uncomment the code on the lines 395-405. However, it should be mentioned that the algorithm, given the current tolerances, takes very small steps in time meaning that one has to ensure not to save to many files as they take up quite a lot of memory. More information on this, can be found in the README-file in the results-folder with the path "Results/README.md". 


# The scripts for calculating the steady states or the initial conditions in the FEMFD-algorithm
By executing the script "calculatingInitialConditions.m", the program returns the initial conditions (u0,v0) given the necessary kinetic parameters (c1,c\_{-1},c\_2,V\_0,c\_{max},d). It also returns the value 1.0 corresponding to classic Turing instability, the value 0.5 for non-classic Turing instability and also it tells the user if no Turing steady state exist for the parameters of interest. The program uses a Newton iteration for finding a solution (u0,v0) to the polynomial equation "f(u,v)=q_0(u,v)" with the constraint that u0 lies in the interval "u0\\in (\\sqrt{c\_2},min(c\_{max},V0/a))" and that the solution satisfies the following constraint "(u0+v0)<min(c\_{max},V0/a))". It is this script that should be used to calculate the initial conditions that are used in the FEMFD algorithm. 

# The scripts for generating the FEM-meshes
The FEM-meshes have been generated using the software [Gmsh](https://gmsh.info/). One can either edit the scripts defining the meshes directly, and these scripts have a format called "geo" (e.g. "Code/GenerateFEMmesh_GmshAndPython/mesh.geo") which can be edited using an editor such as [emacs](https://www.gnu.org/software/emacs/). One can also use the graphical interface of Gmsh to manipulate and create FEM-meshes using the geo file (Fig 1). 

![**Figure 3:** Opening the file \"mesh.geo\" with the graphical interface of Gmsh](../Figures/explanatoryFigures/Gmsh1.png "Opening the file \"mesh.geo\" with the graphical interface of Gmsh")

In the graphical interface, the actual mesh is generated by clicking "Modules>Mesh>Define>1D" followed by "Modules>Mesh>Define>2D" followed by "Modules>Mesh>Define>3D". Then it is important to save the generated mesh which is done by clicking "File->Save mesh", and then a file named "mesh.msh" will be saved in the current directory. It is also possible to visualse the mesh in various ways (Fig 2) and to export images in various format of these visualisations. There are multiple [tutorials](https://gmsh.info/doc/texinfo/gmsh.html#Tutorial) on how to generate meshes in Gmsh. 


![**Figure 4:** Visualising and creating the FEM-mesh from the file \"mesh.geo\".](../Figures/explanatoryFigures/Gmsh2.png "Visualising and creating the FEM-mesh from the file \"mesh.geo\".")
**Figure 4:** Visualising and creating the FEM-mesh from the file \"mesh.geo\".

Importantly, the generated file "mesh.msh" must be converted into an xml-file in order to be able to import it into Python and FEniCS. This is achieved with the script "dolfin-convert.py" (path: "Code/GenerateFEMmesh_GmshAndPython/") which is used as follows

"dolfin-convert mesh.msh mesh.xml". 

Importantly, both FEniCS and DOLFIN must be loaded which is most easily achieved by activating the anaconda client with the command "conda activate cdc42" (see the first README.md file). Lastly, the xml-file must be moved to the same directory that the script "FEMandFD\_solver\_ImpExp\_linear\_tAdaptive\_PoleFinder.py" is saved (path "Code/FEMFD\_AlgorithmForSolvingTheRDsystem\_FEniCSandPython/increasing\_gamma/ScriptsToRun" or "Code/FEMFD\_AlgorithmForSolvingTheRDsystem\_FEniCSandPython/increasing\_d/ScriptsToRun"). As can be seen here, three meshes named "mesh\_ActuallyCoarse.xml", "mesh\_crude.xml" and "mesh_MiddleCoarse.xml" are saved here with different number of nodes. The mesh which the FEMFD-script uses to simulate the RD-model is determined on the lines 82-84 in "FEMandFD\_solver\_ImpExp\_linear\_tAdaptive\_PoleFinder.py". 




# The scripts for generating the Turing mapping of the parameter space
The script that generates the Turing mapping of the parameter space is called "parameterSpacePlot\_NewtonIteration\_20190120.m" (path: "Code/MappingTheTuringParameterSpace\_Matlab/"). It essentially does the same thing as the script that calculates the steady states called "calculatingInitialConditions.m" but in a repeated fashion. The output from the script are the to figure files "c_1VSc2.eps" and "c1VSc2.eps" which are saved in the folder "Figures/paramPlot". As can be read in the original README.md file under the section Matlab, the script uses a parallellised for-loop to speed up the computation. 


# The scripts for generating the plots of the output from the FEM-FD algorithm
The script that generates the data files for plotting the results of the "increase ganna" and "increase d" is called "quantilesOfSimulations.m". It takes the data in "Results/increasingGamma" and "Results/increasing_d" and outputs data files in the sub folders of "Figures/increase\_d" and "Figures/increase\_gamma". 
